# Аудио Стриминг

Приложение для потоковой передачи аудио с поддержкой HLS и синхронизацией между устройствами.

## Установка

Для работы приложения необходимо установить:

1. Node.js (версия 14 или выше)
2. PostgreSQL (версия 12 или выше)

### Шаги установки:

1. Клонировать репозиторий:
```
git clone https://github.com/username/audio-streaming.git
cd audio-streaming
```

2. Установить зависимости для сервера:
```
cd server
npm install
```

3. Установить зависимости для клиента:
```
cd ../client
npm install
```

## Настройка

### Сервер

1. Создайте файл `.env` в директории `server` со следующим содержимым:
```
PORT=5000
NODE_ENV=development
JWT_SECRET=a128d3dc-58b2-4e73-b7bf-68fb4c8e7123
DB_HOST=localhost
DB_USER=postgres
DB_PASS=postgres
DB_NAME=audio_streaming
CORS_ORIGIN=http://localhost:3000
UPLOAD_DIR=uploads
STREAM_DIR=streams
```

2. Создайте базу данных PostgreSQL:
```
createdb audio_streaming
```

### Клиент

Клиент не требует дополнительной настройки, так как он настроен на работу с сервером через прокси.

## Запуск

### Windows

В директории `scripts` находятся готовые скрипты для запуска:

- `start-server.bat` - запуск только сервера
- `start-client.bat` - запуск только клиента
- `start-all.bat` - запуск сервера и клиента одновременно

### Вручную

#### Сервер:
```
cd server
npm run dev
```

#### Клиент:
```
cd client
npm start
```

## Возможные проблемы

### Ошибка "Failed to load resource: net::ERR_CONNECTION_REFUSED"

Эта ошибка возникает, когда клиент не может подключиться к серверу. Причины и решения:

1. **Сервер не запущен**
   - Запустите сервер с помощью скрипта `scripts/start-server.bat` или вручную
   - Убедитесь, что сервер успешно запустился и не выдает ошибок

2. **Неправильные настройки подключения**
   - Проверьте, что сервер запущен на порту 5000 (или том порту, который указан в `.env`)
   - Убедитесь, что в `client/package.json` указан правильный proxy: `"proxy": "http://localhost:5000"`

3. **Проблемы с CORS**
   - Убедитесь, что в файле `.env` на сервере указан правильный `CORS_ORIGIN=http://localhost:3000`

4. **Брандмауэр блокирует соединения**
   - Временно отключите брандмауэр для тестирования
   - Добавьте исключения для портов 3000 и 5000

## Использование

1. Откройте http://localhost:3000 в браузере
2. Зарегистрируйте нового пользователя или войдите в систему
3. После входа вы можете:
   - Загружать аудиофайлы
   - Создавать плейлисты
   - Слушать музыку
   - Синхронизировать позицию воспроизведения между устройствами

## Структура проекта

### Сервер (директория `/server`)

- `/src/routes` - API маршруты
- `/src/controllers` - обработчики запросов
- `/src/models` - модели данных
- `/src/middlewares` - middleware функции
- `/uploads` - загруженные аудиофайлы
- `/streams` - HLS потоки для воспроизведения

### Клиент (директория `/client`)

- `/src/pages` - страницы приложения
- `/src/components` - переиспользуемые компоненты
- `/src/store` - Redux хранилище
- `/src/services` - сервисы для работы с API

## Функциональность

- Авторизация и аутентификация пользователей
- Загрузка и прослушивание аудио файлов
- Создание и управление плейлистами
- Синхронизация позиции воспроизведения между устройствами
- Офлайн режим с кэшированием
- История прослушиваний

## Технологии

- **Фронтенд**: React, Redux
- **Бэкенд**: Node.js, Express.js
- **База данных**: PostgreSQL
- **Аутентификация**: JWT
- **Стриминг**: HLS (HTTP Live Streaming)
- **Контейнеризация**: Docker

## Структура проекта

- `/client` - React-приложение (фронтенд)
- `/server` - Express.js API (бэкенд)
- `/docker` - Docker-конфигурация

## Запуск проекта

### Требования

- Node.js 14+
- PostgreSQL 12+
- Docker и Docker Compose (для контейнеризации)

### Локальный запуск

```bash
# Установка зависимостей для бэкенда
cd server
npm install

# Запуск бэкенда
npm run dev

# Установка зависимостей для фронтенда
cd ../client
npm install

# Запуск фронтенда
npm start
```

### Запуск с Docker

```bash
docker-compose up
```

## API документация

API документация доступна по адресу `/api-docs` после запуска сервера. 